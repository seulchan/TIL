# 마이크로서비스 아키텍처

마이크로 서비스 아키텍처는 기능 위주로 나뉜 여러 애플리케이션이 있고, 각각 독립된 데이터 저장소를 사용한다. 기능으로 분리된 애플리케이션들은 미리 정의된 인터페이스를 통해 서로 유기적으로 동작한다. 그리고 웹이나 APP 클라이언트에 일관된 형태의 API로 제공된다. 이렇게 기능별로 쪼개진 작은 서비스 혹은 시스템을 마이크로서비스라고 한다.

각 마이크로서비스는 독립적으로 동작해야 하고 다른 마이크로서비스에 의존성을 최소화해야 한다. 이를 느슨한 결합(loosely coupled)이라고 한다. 그러므로 마이크로서비스마다 각각 독립된 데이터 저장소가 필요하다.

마이크로서비스 아키텍처의 특징을 정리해 보자.

- 잘 분리된 마이크로서비스로 인한 탈중앙화
- 대규모 시스템을 위한 아키텍처
- 가벼운 네트워크 프로토콜
- 느슨한 결합
- 서비스 지향 아키텍처

&nbsp;

## 마이크로서비스 아키텍처 장점

### 독립성

하나의 마이크로서비스는 하나의 비즈니스 기능을 담당하므로 다른 마이크로서비스와 간섭이 최소화도니다. 특히 하나의 마이크로서비스는 독립된 데이터 저장소를 갖고 있으므로 데이터 간섭에도 자유롭다. 

### 대용량 데이터를 저장하고 처리하는 데 비교적 자유로움

마이크로서비스는 독립된 데이터 저장소를 갖고 있기 때문에 대용량 데이터를 마이크로서비스마다 나누어 저장할 수 있다. 기본적으로 마이크로서비스 숫자만큼 데이터가 분산 저장된다. 또한 샤딩이나 서비스에 적합한 캐시를 마이크로서비스 단위로 각각 적용할 수 있다.

### 시스템 장애에 견고

마이크로서비스는 서로 느슨하게 결합되어 있고, 각각 독립되어 있기 때문에 서로 간에 미치는 영향이 적다. 

### 서비스 배포 주기가 빠름

마이크로서비스 환경에서는 모든 기능이 분리되어 있으므로 필요한 기능만 먼저 배포할 수 있다. 

### 확장성

마이크로서비스 단위로 확장할 수 있어 서비스 전체적으로 확장성이 좋아진다. 거기에 클라우드 시스템과 결합하면 시스템 컴포넌트들을 동적으로 확장할 수 있다. 또한 필요한 마이크로서비스만 확장할 수 있어 효율적으로 시스템 자원을 사용할 수 있다.

### 사용자 반응에 민첩하게 대응

새로운 서비스를 마이크로서비스로 분리하여 설계하고 시스템에 포함하면 사용자 반응에 따라 시스템을 고도화하거나 빠르게 시스템에서 제외할 수 있다.

&nbsp;

## 마이크로서비스 아키텍처 단점

### 개발하기 어려운 아키텍처

가장 큰 원인은 다른 시스템이 네트워크상에 분산되어 있기 때문이다. 즉, 프로세스가 다른 마이크로서비스를 개발할 때는 여러 상황을 고려해야 한다. 크게 고려할 것들은 분리된 데이터, 네트워크를 통한 데이터 통합이다.

### 운영하기 매우 어려운 아키텍처

### 설계하기 어려운 아키텍처

### 마이크로서비스 아키텍처로 설계된 서비스 운영에는 여러 가지 자동화된 시스템 필요

### 마이크로서비스를 운영하고 개발하는 개발자의 기술력이 좋아야 한다

&nbsp;

## 마이크로서비스 아키텍처 설계

### 서비스 세분화 원칙

서비스 세분화 원칙은 네 개의 요소로 구성되어 있으며, 이 네 가지 요소를 기반을 서비스를 나누도록 제안한다. 네 개의 요소는 각각 비즈니스 기능, 성능, 메시지 크기, 트랜잭션이다.

1. 비즈니스 기능
    > 비즈니스 기능으로 서비스를 나눈다. 이상적으로 각각의 서비스는 비즈니스 동작과 일대일로 연결되어 있다.
2. 성능
    > 마이크로서비들은 분리되어 있으므로 네트워크와 프로토콜을 써서 서로의 데이터나 기능을 사용한다. 이때 특정 마이크로서비스의 성능이 떨어진다면 해당 서비스를 나누는 것을 고려할 만하다.
3. 메시지 크기
    > API를 설계하는 데 메시지 크기가 크다면 마이크로서비스를 나누는 것을 고려하자.
4. 트랜잭션
    > 데이터 정합성을 유지하는 트랜잭션으로 서비스를 나누는 것도 좋다.

### 도메인 주도 설계의 바운디드 컨텍스트

도메인은 비즈니스 전체나 조직이 행하는 일을 의미한다. 도메인은 서브 도메인들로 구분할 수 있는데, 개발자는 어떤 서브 도메인을 포함하고 도메인을 어떻게 소프트웨어로 구현할지 집중해야 한다. 구현할 때 개발자는 도메인 모델을 모델링한다. 이때 도메인 모델이 존재하는 다른 도메인 모델과 확연히 구분되는 명시적인 경계를 바운디드 컨테스트라고 한다. 바운디드 컨텍스트는 다른 도메인 모델과 구분되므로 매우 독립적인 영역이다. 그러므로 구분된 바운디드 컨텍스트로 마이크로서비스를 설계하면 다른 마이크로 서비스와 중복될 확률이 매우 줄어든다.

### 단일 책임 원칙

하나의 책임을 갖는 마이크로서비스도 바운디드 컨텍스트처럼 독립 영역을 갖게 된다. 그래서 다른 마이크로서비스들과 간섭이 줄어들고 변경도 자유롭다.

### 가벼운 통신 프로토콜

마이크로서비스 사이에 네트워크 통신은 가벼워야 하며, 프로토콜은 특정 기술이나 언어에 의존성이 없어야 한다.

### 외부 공개 인터페이스

마이크로서비스가 외부에 공개하는 인터페이스를 설계할 때는 매우 신중해야 한다. 

### 마이크로 서비스마다 독립된 데이터 저장소

&nbsp;

Excerpt From <스프링 부트로 개발하는 MSA 컴포넌트> by 김병부