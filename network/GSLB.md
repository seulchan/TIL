# GSLB

GSLB (Global Server/Service Load Balancing)는  도메인을 이용한 로드 밸런싱 구현을 도와줍니다. GSLB는 DNS와 동일하게 도메인 질의에 응답해주는 역할과 동시에 로드 밸런서처럼 등록된 도메인에 연결된 서비스가 정상적인지 헬스 체크를 수행합니다. 즉, 등록된 도메인에 대한 서비스가 정상인지 상태를 체크해 정상인 레코드에 대해서만 사용합니다.

&nbsp;

## GSLB 동작 방식

1. 사용자가 web.naver.com에 접속하기 위해 DNS에 질의합니다.
2. LDNS는 web.naver.com을 관리하는 NS 서버를 찾기 위해 root부터 순차 질의합니다.
3. naver.com을 관리하는 NS 서버로 web.naver.com에 대해 질의합니다.
4. DNS 서버는 GSLB로 web.naver.com에 대해 위임했으므로 GSLB 서버가 NS 서버라고 LDNS에 응답합니다.
5. LDNS는 다시 GSLB로 web.naver.com에 대해 질의합니다.
6. GSLB는 web.naver.com에 대한 IP 주솟값 중 현재 설정된 분산 방식에 따라 서울 또는 부산 데이터 센터의 IP 주솟값을 DNS에 응답합니다. GSLB가 응답하는 값은 GSLB에서 설정한 주기에 따라 서울과 부산 데이터 센터로 헬스 체크해 정상적인 값만 응답합니다.
7. GSLB에서 결괏값을 응답받은 LDNS는 사용자에게 web.naver.com이 1.1.1.1로 서비스하고 있다고 최종 응답합니다.

정리하면 GSLB는 일반 DNS를 사용하는 것과 거의 동일하게 동작합니다. 다만 GSLB에서 서비스 IP 정보에 대한 헬스 체크와 사전에 지정한 다양한 분산 방법을 이용한 부하 분산이 일반 DNS와 큰 차이점이라고 볼 수 있습니다.

&nbsp;

## GSLB 구성 방식

GSLB를 사용한 도메인 설정 방법은 두 가지가 있습니다.

- 도메인 자체를 GSLB로 사용
- 도메인 내의 특정 레코드만 GSLB를 사용

### 도메인 자체를 GSLB로 사용

도메인 자체를 GSLB로 사용하면 해당 도메인에 속하는 모든 레코드 설정을 GSLB 장비에서 관리합니다. 즉, 도메인에 대한 모든 레코드를 GSLB에서 설정합니다. 도메인 구입 시 도메인에 대한 권한을 갖는 네임 서버를 지정하는데 이 네임 서버가 도메인을 관리합니다. 도메인 자체를 GSLB로 사용하는 것은 도메인에 대한 네임 서버를 GSLB로 지정하고 GSLB에서 도메인에 대한 모든 레코드를 등록해 처리하는 방식입니다. 즉, GSLB 자체가 도메인의 네임 서버 역할을 하는 경우입니다.

이 경우에는 도메인의 레코드 중 헬스 체크 기능이 불필요한 경우뿐만 아니라 모든 레코드에 대한 질의가 GSLB를 통해 이루어지므로 GSLB에 부하를 주게 됩니다.

### 도메인 내의 특정 레코드만 GSLB를 사용

DNS에서 도메인 설정 시 GSLB를 사용하려는 레코드에 대해서만 GSLB로 처리하도록 설정합니다. 회사 대표 도메인에 속한 레코드 중 GSLB 적용이 불필요한 경우가 많아 도메인 내의 특정 레코드에 대해서만 GSLB로 처리를 이관하는 방식을 사용합니다. 특정 레코드에 대해서만 GSLB로 처리를 이관하는 방법은 두 가지입니다.

- 별칭(Alias)를 사용 (CNAME 레코드 사용)
- 위임(Delegation) 사용 (NS 레코드 사용)

별칭을 이용해 GSLB를 사용하는 방법은 실제 도메인과 다른 별도의 도메인 레코드로 GSLB에 등록됩니다. 일반적으로 외부 CDN을 사용하거나 회사 내부에 GSLB를 사용해야 할 도메인이 많은 경우 한꺼번에 관리하기 위해 사용합니다. 

위임을 이용해 GSLB를 사용하는 경우, 실제 도메인과 동일한 도메인 레코드를 사용하며 도메인 전체를 위임하는 것이 대표적인 예입니다.

정리하면 별칭을 이용해 GSLB를 사용하는 경우, CDN처럼 GSLB를 운영해주는 외부 사업자가 있거나 GSLB를 사용해야 하는 도메인이 매우 많은 경우, 별도의 GSLB를 운영하기 위해 사용합니다. 위임의 경우에는 DNS와 같은 도메인으로 GSLB를 운영하면서 계층적으로 GSLB를 이용한 FQDN을 관리할 때 사용될 수 있습니다. 많은 환경에서 다양한 서비스가 혼재되어 있으므로 NS와 CNAME 방식을 혼용하여 사용하기도 합니다.

&nbsp;

## GSLB 분산 방식

GSLB를 이용해 서비스를 분산하면 다음과 같은 주요 목적을 달성할 수 있습니다.

- 서비스 제공의 가능 여부를 체크해 트래픽 분산
- 지리적으로 멀리 떨어진 다른 데이터 센터에 트래픽 분산
- 지역적으로 가까운 서비스에 접속해 더 빠른 서비스 제공이 가능하도록 분산

각 GSLB에서 지원되는 분산 방식은 GSLB 장비를 생산하는 벤더와 모델에 따라 조금씩 다를 수 있지만 대부분 다음 두 가지 헬스 체크 모니터링 요소를 지원하고 있습니다.

- 서비스 응답 시간/지연 
- IP에 대한 지리 정보

서비스 응답/지연 시간 항목은 서비스 요청에 대한 응답이 얼마나 빠른지 또는 지연이 얼마나 없는지를 확인하고 이것을 이용해 서비스를 분산 처리합니다.

IP에 대한 지리 정보는 서비스 제공이 가능한 각 사이트의 IP 주소에 대한 Geo 값을 확인해 가까운 사이트로 서비스 분산을 처리합니다. 

&nbsp;

Excerpt From <IT 엔지니어를 위한 네트워크 입문> by 고재성, 이상훈