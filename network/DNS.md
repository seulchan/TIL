# DNS

DNS (Domain Name System)는 도메인 주소를 IP 주소로 변환하는 역할을 합니다. IP주소보다 도메인 주소를 이용하는 것이 일반 사용자에게 더 익숙하고 서버 IP 변경에 쉽게 대처할 수 있으므로 네트워크 통신에서 DNS의 역할이 매우 중요합니다.

&nbsp;

## DNS 구조와 명명 규칙

도메인은 계층 구조여서 수많은 인터넷 주소 중 원하는 주소를 효율적으로 찾아갈 수 있습니다. 역트리 구조로 최상위 루트부터 Top-Level 도메인, Second-Level 도메인, Third-Level 도메인과 같이 하위 레벨로 원하는 주소를 단계적으로 찾아갑니다. 우리가 도메인 주소를 사용할 때는 각 계층의 경계를 "."으로 표시하고 뒤에서 앞으로 해석합니다.

도메인 계층은 최대 128계층까지 구성할 수 있습니다. 계층별 길이는 최대 63바이트까지 사용할 수 있고 도메인 계층을 구분하는 구분자 "."를 포함한 전체 도메인 네임의 길이는 최대 255바이트까지 사용할 수 있습니다.

### 루트 도메인

루트 도메인은 도메인을 구성하는 최상위 영역입니다. DNS 서버는 사용자가 쿼리한 도메인에 대한 값을 직접 갖고 있거나 캐시에 저장된 정보를 이용해 응답합니다. 만약 DNS 서버에 해당 도메인의 정보가 없으면 루트 도메인을 관리하는 루트 DNS에 쿼리하게 됩니다.

루트 DNS는 전 세계에 13개가 있고 DNS 서버를 설치하면 루트 DNS의 IP 주소를 기록한 힌트 파일을 가지고 있어 루트 DNS 관련 정보를 별도로 설정할 필요가 없습니다.

### Top-Level Domain (TLD)

최상위 도메인인 TLD는 IANA에서 구분한 6가지 유형으로 구분할 수 있습니다. 각 유형은 다음과 같습니다.

- Generic (gTLD)
  - gTLD는 특별한 제한없이 일반적으로 사용되는 최상위 도메인이며 세 글자 이상으로 구성됩니다. 예를 들어 .com, .edu, .gov, .int, .mil, .net, .org 등이 있습니다.

- Country Code TLD (ccTLD)
  - ccTLD는 국가 최상우 ㅣ도메인으로 ISO 3166 표준에 의해 규정된 두 글자의 국가 코드를 사용합니다. 일반적으로 ccTLD를 사용하는 경우, Second Level TLD에는 gTLD에서 구분한 것처럼 사이트 용도에 따른 코드를 사용합니다. 

- Sponsored (sTLD)
  - sLTD는 특정 목적을 위한 스폰서를 두고 있는 최상위 도메인입니다. 스폰서는 특정 민족공동체, 전문가 집단,  지리적 위치 등이 속할 수 있습니다. sTLD의 종류에는 .aero, .asia, .edu, .museum 등이 있습니다.

- Infrastructure
  - 운용상 중요한 인프라 식별자 공간을 지원하기 위해 전용으로 사용되는 최상위 도메인입니다. Infrastructure에 속하는 TLD는 .arpa입니다. .arpa는 인터넷 안정성을 유지하기 위해 새로운 모든 인프라 하위 도메인이 배치될 도메인 공간 역할을 합니다.

- Generic-restricted (grTLD)
  - grTLD는 특정 기준을 충족하는 사람이나 단체가 사용할 수 있는 최상위 도메인입니다. grTLD의 종류에는 .biz, .name, .pro가 있습니다.

- Test (tTLD)
  - tTLD는 IDN 개발 프로세스에서 테스트 목적으로 사용하는 최상위 도메인입니다. tTLD의 종류에는 .test가 있습니다.

&nbsp;

## DNS 동작 방식

### 쿼리 과정

1. 사용자 호스트는 'naver.com'이라는 도메인 주소의 IP 주소가 로컬 캐시에 젖아되어 있는지 확인
2. 'naver.com'이 로컬 내시에 저장되어 있지 않으면 사용자 호스트에 설정된 DNS에 'naver.com'에 대해 쿼리
3. DNS 서버는 'naver.com'이 로컬 캐시와 자체에 설정되어 있는지 직접 확인하고 없으면 해당 도메인을 찾기 위해 루트 NS에 .com에 대한 TLD 정보를 가진 도메인 주소를 쿼리
4. 루트 DNS는 'naver.com'의 TLD인 .com을 관리하는 TLD 네임 서버 정보를 DNS 서버에 응답
5. DNS는 TLD 네임 서버에 'naver.com'에 대한 정보를 다시 쿼리
6. TLD 네임 서버는 'naver.com'에 대한 정보를 가진 naver 네임 서버에 대한 정보를 DNS 서버로 응답
7. DNS는 naver 네임 서버에 'naver.com'에 대한 정보를 쿼리
8. naver 네임 서버는 'naver.com'에 대한 정보를 DNS 응답
9. DNS는 'naver.com'에 대한 정보를 로컬 캐시에 저장하고 사용자 호스트에 'naver.com'에 대한 정보를 응답
10. 사용자 호스트는 DNS로부터 받은 'naver.com'에 대한 IP 정보를 이용해 사이트에 접속

&nbsp;

## 마스터와 슬레이브

DNS 서버는 마스터 서버와 슬레이브 서버로 나눌 수 있습니다. 마스터 서버가 우선순위가 더 높지 않고 두 서버 모두 도메인 쿼리에 응답합니다. 마스터와 슬레이브는 도메인에 대한 존 파일을 직접 관리하는지 여부로 구분합니다. 마스터 서버는 존 파일을 직접 생성해 도메인 관련 정보를 관리하고 슬레이브 서버는 마스터에 만들어진 존 파일을 복제합니다. 이 과정을 '영역 전송'이라고 합니다. 마스터 서버는 도메인 영역을 생성하고 레코드를 직접 관리하지만 슬레이브 서버는 마스터 서버에 설정된 도메인이 가진 레코드값을 정기적으로 복제합니다.

&nbsp;

Excerpt From <IT 엔지니어를 위한 네트워크 입문> by 고재성, 이상훈
